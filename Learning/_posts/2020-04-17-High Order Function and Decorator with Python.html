<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-04-20 Mon 01:26 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python - High Order Function &amp; Decorator</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Mishka Nguyen" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://akhsim.github.io/read-akhsiM-orgs/styles/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://akhsim.github.io/read-akhsiM-orgs/styles/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://akhsim.github.io/read-akhsiM-orgs/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://akhsim.github.io/read-akhsiM-orgs/styles/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Python - High Order Function &amp; Decorator</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf8c787b">First-Class Functions &amp; Higher Order Functions</a>
<ul>
<li><a href="#org77c15cc">General introduction &amp; Definition</a></li>
<li><a href="#org0c5b474">Example of First Class Function</a></li>
<li><a href="#orgf3afe49">High Order Function and why it's related to First Class Function</a></li>
<li><a href="#org8fc9a53">Example 1 of High Order Function: The <b>map</b> function</a></li>
<li><a href="#orgf2504f1">Example 2 of High Order Function: return another function with <b>logger</b> function</a></li>
<li><a href="#orgccd6722">A "close to real life" example of High Order Function</a></li>
<li><a href="#orgcb29663">What is Closure?</a></li>
</ul>
</li>
<li><a href="#org3b61dda">Decorator</a>
<ul>
<li><a href="#orgf1a62d3">First Example</a></li>
<li><a href="#org7ac17de">Comes the Decorator</a></li>
<li><a href="#org7bdd70a">The decorator syntax</a></li>
<li><a href="#orgdc80cdf">Working with function with argument(s)</a></li>
<li><a href="#org09fe7b8">Working with Classes as decorator</a></li>
<li><a href="#orgc397f33">Looking at a practical example for decorator</a></li>
</ul>
</li>
<li><a href="#org60fcffc">Stacking decorators with <b>functool</b> module and the <b>wrap</b> decorator</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgf8c787b" class="outline-2">
<h2 id="orgf8c787b">First-Class Functions &amp; Higher Order Functions</h2>
<div class="outline-text-2" id="text-orgf8c787b">
</div>
<div id="outline-container-org77c15cc" class="outline-3">
<h3 id="org77c15cc">General introduction &amp; Definition</h3>
<div class="outline-text-3" id="text-org77c15cc">
<p>
In this article I am learning about Python decorators. However, it is important to grasp the concepts of first-class functions, higher-order functions before moving on to decorator. This is because "high-order function" is the underlying concept that engines the usage of decorator.<br />
</p>

<p>
Let's note down some key concepts. I found these from various sources on the Internet. There are a lot of ways which the definitions can be stated, these are the simplest, the most ELI:<br />
</p>

<blockquote>
<p>
&#x2026;<br />
When you say that a language has first-class functions, it means that the language treats functions as values – that you can assign a function into a variable, pass it around etc. Higher-order functions are functions that work on other functions, meaning that they take one or more functions as an argument and can also return a function.<br />
</p>

<p>
The “higher-order” concept can be applied to functions in general, like functions in the mathematical sense. The “first-class” concept only has to do with functions in programming languages. It’s seldom used when referring to a function, such as “a first-class function”. It’s much more common to say that “a language has/hasn’t first-class function support”.<br />
</p>

<p>
The two things are closely related, as it’s hard to imagine a language with first-class functions that would not also support higher-order functions, and conversely a language with higher-order functions but without first-class function support.<br />
&#x2026;<br />
First class functions are functions that are treated like an object (or are assignable to a variable).<br />
</p>

<p>
Higher order functions are functions that take at least one first class function as a parameter, or return at least one first class function.<br />
&#x2026;<br />
(<a href="https://stackoverflow.com/questions/10141124/any-difference-between-first-class-function-and-high-order-function">https://stackoverflow.com/questions/10141124/any-difference-between-first-class-function-and-high-order-function</a>)<br />
</p>
</blockquote>

<blockquote>
<p>
A Programming language is said to have first-class functions if it treats functions as first-class citizens. &#x2013; Wikipedia<br />
</p>
</blockquote>

<blockquote>
<p>
A first-class citizen (sometiems called first-class objects) in a programming language is an entity which supports all the operations generally available to other entities. These operations typically include being passed as an argument, returned from a fucntion and assigned to a variable. &#x2013; Wikipedia<br />
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org0c5b474" class="outline-3">
<h3 id="org0c5b474">Example of First Class Function</h3>
<div class="outline-text-3" id="text-org0c5b474">
<p>
Let's take an example of how a function can be passed in as an argument:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">square</span>(x):
        <span style="color: #ff6188;">return</span> x * x

<span style="color: #fcfcfa;">f</span> = square(5)
<span style="color: #fcfcfa;">z</span> = square


<span style="color: #ff6188;">print</span>(square)
<span style="color: #ff6188;">print</span>(z)
<span style="color: #ff6188;">print</span>(f)
<span style="color: #ff6188;">print</span>(z(5))
</pre>
</div>

<pre class="example">
&lt;function square at 0x7f2574a910d0&gt;
&lt;function square at 0x7f2574a910d0&gt;
25
25
</pre>


<p>
In the above example, when we printed out <code>z</code>, <code>z</code> is equal to the <code>square</code> function. This is one of the aspects what it means to be a first-class function, i.e <code>z</code> is a first-class function. We can treat variable <code>z</code> like a function, this is demonstrated by <code>z(5)</code>.<br />
</p>
</div>
</div>

<div id="outline-container-orgf3afe49" class="outline-3">
<h3 id="orgf3afe49">High Order Function and why it's related to First Class Function</h3>
<div class="outline-text-3" id="text-orgf3afe49">
<p>
<b>High-order function</b>: One of the consequences  of having first-class fucntions is that we can then pass on a function as an argument to another function. This latter function is now called <b>higher order</b>. A high order function is one that takes a function as an argument.<br />
</p>

<p>
A high order function can also be a fucntion that <b>return</b> another function.<br />
</p>
</div>
</div>

<div id="outline-container-org8fc9a53" class="outline-3">
<h3 id="org8fc9a53">Example 1 of High Order Function: The <b>map</b> function</h3>
<div class="outline-text-3" id="text-org8fc9a53">
<p>
A great example of passing a function as an argument to another function is the <code>map</code> function. The <code>map</code> function takes a function and an array as its argument. It runs each value of the array through the function and then returns a new array of the results.<br />
</p>

<p>
We can see this in our custom map function below:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">square</span>(x):
        <span style="color: #ff6188;">return</span> x * x

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">cube</span>(x):
        <span style="color: #ff6188;">return</span> x * x * x

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">my_map</span>(func, arg_list):
        <span style="color: #fcfcfa;">result</span> = []
        <span style="color: #ff6188;">for</span> i <span style="color: #ff6188;">in</span> arg_list:
                result.append(func(i))
        <span style="color: #ff6188;">return</span> result

<span style="color: #ff6188;">print</span>(my_map(square, [1, 2, 3, 4, 5]))
<span style="color: #ff6188;">print</span>(my_map(cube, [1, 2, 3, 4, 5]))
</pre>
</div>

<pre class="example">
[1, 4, 9, 16, 25]
[1, 8, 27, 64, 125]
</pre>


<p>
<b>Note</b>: In the above example, when we pass the function <code>cube()</code> and <code>square()</code> into the <code>my_map()</code> function, we are <b>not</b> executing the functions. Therefore we should <b>not</b> include the parentheses.<br />
</p>
</div>
</div>

<div id="outline-container-orgf2504f1" class="outline-3">
<h3 id="orgf2504f1">Example 2 of High Order Function: return another function with <b>logger</b> function</h3>
<div class="outline-text-3" id="text-orgf2504f1">
<p>
This can be quite complicated.<br />
</p>

<p>
In the example below we have a <code>logger()</code> function. Within it we have a <code>log_message()</code> function that does not take any argument. When then <code>log_message()</code> function runs it prints out 'Log' and the argument that is passed to the <code>logger()</code> function.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">logger</span>(msg):

        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">log_message</span>():
                <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">'Log:'</span>, msg)

        <span style="color: #ff6188;">return</span> log_message

<span style="color: #fcfcfa;">log_hello</span> = logger(<span style="color: #ffd866;">"Hello world!"</span>)
log_hello()

</pre>
</div>

<pre class="example">
Log: Hello world!
</pre>


<p>
An important point to note is that when we call the execution of <code>log_hello()</code> it remembers the argument that was passed in the initial <code>logger()</code> function in the previous line. This is what we call "closure".<br />
</p>
</div>
</div>

<div id="outline-container-orgccd6722" class="outline-3">
<h3 id="orgccd6722">A "close to real life" example of High Order Function</h3>
<div class="outline-text-3" id="text-orgccd6722">
<p>
Another example of why we would be returning a function as a result of another function is:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">html_tag</span>(tag):
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrap_text</span>(msg):
                <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"&lt;{0}&gt;{1}&lt;/{0}&gt;"</span>.<span style="color: #ab9df2;">format</span>(tag, msg))

        <span style="color: #ff6188;">return</span> wrap_text

<span style="color: #fcfcfa;">print_h1</span> = html_tag(<span style="color: #ffd866;">'h1'</span>)
<span style="color: #fcfcfa;">print_p</span> = html_tag(<span style="color: #ffd866;">'p'</span>)

print_h1(<span style="color: #ffd866;">"This is a headline."</span>)
print_p(<span style="color: #ffd866;">"This is a line of paragraph."</span>)
</pre>
</div>

<pre class="example">
&lt;h1&gt;This is a headline&lt;/h1&gt;
&lt;p&gt;This is a line of paragraph.&lt;/p&gt;
</pre>


<p>
In the above example, both the <code>print_h1</code> and <code>print_p</code> variables are object of a higher order function <code>html_wrap()</code>. When we used <code>print_h</code>, for example, we are basically using <code>html_tag</code> with a <b>remembered</b> argument of <code>'h1'</code>.<br />
</p>
</div>
</div>

<div id="outline-container-orgcb29663" class="outline-3">
<h3 id="orgcb29663">What is Closure?</h3>
<div class="outline-text-3" id="text-orgcb29663">
<p>
Closure is the method of binding data to a function without actually passing them as parameters. It is a function object that remember values in enclosing scopes even if they are not present in memory.<br />
</p>

<p>
A closure is a function obejct that remember values in enclosing scopes even if they are not present in memory.<br />
</p>
</div>
</div>
</div>
<div id="outline-container-org3b61dda" class="outline-2">
<h2 id="org3b61dda">Decorator</h2>
<div class="outline-text-2" id="text-org3b61dda">
</div>
<div id="outline-container-orgf1a62d3" class="outline-3">
<h3 id="orgf1a62d3">First Example</h3>
<div class="outline-text-3" id="text-orgf1a62d3">
<p>
Let's take an example:<br />
</p>
<ul class="org-ul">
<li>We have an outer function that doesn't take any parameter<br /></li>
<li>Within the outer function, we have a variable <code>message</code>.<br /></li>
<li>Within the outer function, we also have an inner message that can access the <code>message</code> variable.<br /></li>
</ul>
<p>
&gt;&gt; When execute the outter function, the inner function is executed.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">outer_function</span>():
        <span style="color: #fcfcfa;">message</span> = <span style="color: #ffd866;">'Hi'</span>
        
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">inner_function</span>():
                <span style="color: #ff6188;">print</span>(message)
        
        <span style="color: #ff6188;">return</span> inner_function()

outer_function()
</pre>
</div>

<pre class="example">
Hi
</pre>


<p>
Let's instead return the inner function without executing it:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">outer_function</span>():
        <span style="color: #fcfcfa;">message</span> = <span style="color: #ffd866;">'Hi'</span>
        
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">inner_function</span>():
                <span style="color: #ff6188;">print</span>(message)
        
        <span style="color: #ff6188;">return</span> inner_function

<span style="color: #ff6188;">print</span>(outer_function())
</pre>
</div>

<pre class="example">
&lt;function outer_function.&lt;locals&gt;.inner_function at 0x7f376df2b040&gt;
</pre>


<p>
We can also assign this to a variable object that is waiting to be executed:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">outer_function</span>():
        <span style="color: #fcfcfa;">message</span> = <span style="color: #ffd866;">'Hi'</span>
        
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">inner_function</span>():
                <span style="color: #ff6188;">print</span>(message)
        
        <span style="color: #ff6188;">return</span> inner_function

<span style="color: #fcfcfa;">my_func</span> = outer_function()
my_func()
my_func()
my_func()
</pre>
</div>

<pre class="example">
Hi
Hi
Hi
</pre>


<p>
Let's make some changes to the outer function. We'll make it take an actual argument. The argument will just be what was previously the local variable <code>message</code>.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">outer_function</span>(message):
        
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">inner_function</span>():
                <span style="color: #ff6188;">print</span>(message)
        
        <span style="color: #ff6188;">return</span> inner_function

<span style="color: #fcfcfa;">hi_function</span> = outer_function(<span style="color: #ffd866;">"Hi"</span>)
<span style="color: #fcfcfa;">hello_function</span> = outer_function(<span style="color: #ffd866;">"Hello"</span>)

hi_function()
hello_function()
</pre>
</div>

<pre class="example">
Hi
Hello
</pre>
</div>
</div>

<div id="outline-container-org7ac17de" class="outline-3">
<h3 id="org7ac17de">Comes the Decorator</h3>
<div class="outline-text-3" id="text-org7ac17de">
<p>
Decorators are very similar to what we just did above.<br />
</p>

<p>
Decorators provide a simple syntax for calling higher-order functions. By definition, a decorator is a function that takes another function and extends the behaviour of the latter function by adding some functionalities. All of this is done without explicitly modifying the function that is passed in.<br />
</p>

<p>
Let's look at an example:<br />
</p>
<ul class="org-ul">
<li>The example is similar to the above with a change of naming<br /></li>
<li>We start with a decorator function which is similar to the outer function above:<br /></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">decorator_function</span>(message):        
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">warpper_function</span>():
                <span style="color: #ff6188;">print</span>(message)  
        <span style="color: #ff6188;">return</span> wrapper_function
</pre>
</div>

<p>
.. however instead of passing in <code>message</code> , which is a string, as the argument, we want to pass in a function argument.<br />
</p>

<p>
We also create another function that can be passed in as the argument.<br />
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">decorator_function</span>(original_function):      
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_function</span>():
                <span style="color: #ff6188;">return</span> original_function()      
        <span style="color: #ff6188;">return</span> wrapper_function

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">display</span>():
        <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">'display function ran'</span>)

<span style="color: #fcfcfa;">decorated_display</span> = decorator_function(display)
decorated_display()
</pre>
</div>

<pre class="example">
display function ran
</pre>


<p>
In this extremely simple example, when we run <code>decorated_display()</code> we actually run the <code>display()</code> function through the inner <code>wrapper_function</code> function.<br />
</p>

<p>
Why the hell would we want to do this? Well we would want to do this when we want to add some functionalities into the original function through the use of wrapper function.<br />
</p>

<p>
Let's change our script a bit - say the added functionality is to simply print an additional line:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">decorator_function</span>(original_function):      
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_function</span>():
                <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"The below function - '{original_function.__name__}' has been wrapped in a decorator."</span>)
                <span style="color: #ff6188;">return</span> original_function()      
        <span style="color: #ff6188;">return</span> wrapper_function

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">display</span>():
        <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"display function ran"</span>)

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">say_hello</span>():
        <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"Hello world"</span>)

<span style="color: #fcfcfa;">decorated_display</span> = decorator_function(display)
decorated_display()
<span style="color: #fcfcfa;">decorated_display</span> = decorator_function(say_hello)
decorated_display()
</pre>
</div>

<pre class="example">
The below function - 'display' has been wrapped in a decorator.
display function ran
The below function - 'say_hello' has been wrapped in a decorator.
Hello world
</pre>
</div>
</div>

<div id="outline-container-org7bdd70a" class="outline-3">
<h3 id="org7bdd70a">The decorator syntax</h3>
<div class="outline-text-3" id="text-org7bdd70a">
<p>
The syntax of Python decorator is simple. We simply put the higher order function right before the original function, which is the first order function with the decorator symbol <code>@</code> at the start. Doing this, we ensure that every time we run the first order function, it gets the added functionality of the higher order function.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">decorator_function</span>(original_function):      
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_function</span>():
                <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"The below function - '{original_function.__name__}' has been wrapped in a decorator."</span>)
                <span style="color: #ff6188;">return</span> original_function()      
        <span style="color: #ff6188;">return</span> wrapper_function

<span style="color: #78dce8;">@decorator_function</span>
<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">say_hello</span>():
        <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"Hello world"</span>)

say_hello()
say_hello()
</pre>
</div>

<pre class="example">
The below function - 'say_hello' has been wrapped in a decorator.
Hello world
The below function - 'say_hello' has been wrapped in a decorator.
Hello world
</pre>
</div>
</div>

<div id="outline-container-orgdc80cdf" class="outline-3">
<h3 id="orgdc80cdf">Working with function with argument(s)</h3>
<div class="outline-text-3" id="text-orgdc80cdf">
<p>
The above simple syntax only works with original functions that do not take any argument. If we try this with a function that takes arguments, we'd get TypeError:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">decorator_function</span>(original_function):      
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_function</span>():
                <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"The below function - '{original_function.__name__}' has been wrapped in a decorator."</span>)
                <span style="color: #ff6188;">return</span> original_function()      
        <span style="color: #ff6188;">return</span> wrapper_function

<span style="color: #78dce8;">@decorator_function</span>
<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">display_name</span>(name):
        <span style="color: #ff6188;">print</span>(name)

display_name(<span style="color: #ffd866;">'John'</span>)
</pre>
</div>

<pre class="example">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/tmp/babel-RnTXfm/python-axzpJT", line 15, in &lt;module&gt;
    display_name('John')
TypeError: wrapper_function() takes 0 positional arguments but 1 was given
</pre>


<p>
.. So what we need is to be able to pass any number of positional or keyword arguments to our wrapper function and have it executing our original function with the arguments.<br />
</p>

<p>
This is simple. We simply add <b>"*args, **kwargs"</b> which to the wrapper function as well as the wrapped original function. Simply put, these additions makes the functions take any number of argument that is passed to it.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">decorator_function</span>(original_function):      
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_function</span>(*args, **kwargs):
                <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"The below function - '{original_function.__name__}' has been wrapped in a decorator."</span>)
                <span style="color: #ff6188;">return</span> original_function(*args, **kwargs)       
        <span style="color: #ff6188;">return</span> wrapper_function

<span style="color: #78dce8;">@decorator_function</span>
<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">display_name</span>(name):
        <span style="color: #ff6188;">print</span>(name)

display_name(<span style="color: #ffd866;">'John'</span>)
</pre>
</div>

<pre class="example">
The below function - 'display_name' has been wrapped in a decorator.
John
</pre>
</div>
</div>
<div id="outline-container-org09fe7b8" class="outline-3">
<h3 id="org09fe7b8">Working with Classes as decorator</h3>
<div class="outline-text-3" id="text-org09fe7b8">
<p>
Instead of using functions, we can also use Classes as decorator.<br />
</p>

<p>
When we create the decorator function, we pass the original function as an argument. We won't be able to do the exact same thing with Class. With class we use the  <code>init</code> dunder method.<br />
</p>

<p>
Then to add the additional functionality to the original function, we can implement the dunder <code>__call__</code> method.<br />
</p>

<p>
In the below example, for ease of reference I'm going to leave the decorator function in the script so we can compare the construction of class decorator versus function decorator.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">decorator_function</span>(original_function):      
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_function</span>():
                <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"The below function - '{original_function.__name__}' has been wrapped in a decorator."</span>)
                <span style="color: #ff6188;">return</span> original_function()      
        <span style="color: #ff6188;">return</span> wrapper_function


<span style="color: #ff6188;">class</span> <span style="color: #78dce8;">decorator_class</span>(<span style="color: #ab9df2;">object</span>):

        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">__init__</span>(<span style="color: #ff6188;">self</span>, original_function):
                <span style="color: #ff6188;">self</span>.original_function = original_function
        
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">__call__</span>(<span style="color: #ff6188;">self</span>, *args, **kwargs):
                <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"The wrapper call method executed this before '{self.original_function.__name__}'"</span>)
                <span style="color: #ff6188;">return</span> <span style="color: #ff6188;">self</span>.original_function(*args, **kwargs)

<span style="color: #78dce8;">@decorator_class</span>
<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">hello</span>():
        <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"Hello world"</span>)
        
hello()
</pre>
</div>

<pre class="example">
The wrapper call method executed this before 'hello'
Hello world
</pre>
</div>
</div>
<div id="outline-container-orgc397f33" class="outline-3">
<h3 id="orgc397f33">Looking at a practical example for decorator</h3>
<div class="outline-text-3" id="text-orgc397f33">
<p>
A very common use case for decorator is indeed <b>logging</b>.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">my_logger</span>(orig_func):
        <span style="color: #ff6188;">import</span> logging
        logging.basicConfig(filename=<span style="color: #ffd866;">'{}.log'</span>.<span style="color: #ab9df2;">format</span>(orig_func.<span style="color: #ab9df2;">__name__</span>), level=logging.INFO)

        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper</span>(*args, **kwargs):
                logging.info(
                        <span style="color: #ffd866;">"Ran with args: {}, and kwargs: {}"</span>.<span style="color: #ab9df2;">format</span>(args, kwargs)
                )
                <span style="color: #ff6188;">return</span> orig_func(*args, **kwargs)

        <span style="color: #ff6188;">return</span> wrapper

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">my_timer</span>(orig_func):
        <span style="color: #ff6188;">import</span> time

        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper</span>(*args, **kwargs):
                <span style="color: #fcfcfa;">t1</span> = time.time()
                <span style="color: #fcfcfa;">result</span> = orig_func(*args, **kwargs)
                <span style="color: #fcfcfa;">t2</span> = time.time() - t1
                <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"{} ran in {} second(s)"</span>.<span style="color: #ab9df2;">format</span>(orig_func.<span style="color: #ab9df2;">__name__</span>, t2))
                <span style="color: #ff6188;">return</span> result
        
        <span style="color: #ff6188;">return</span> wrapper

<span style="color: #78dce8;">@my_logger</span>
<span style="color: #78dce8;">@my_timer</span>
<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">display_info</span>(name, age):
        <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"{name} is {age} years old."</span> )

display_info(<span style="color: #ffd866;">'Kenny'</span>, 26)

</pre>
</div>

<pre class="example">
Kenny is 26 years old.
display_info ran in 4.7206878662109375e-05 second(s)
</pre>


<p>
After we ran the above, a log file was also created in our directory:<br />
</p>

<div class="org-src-container">
<pre class="src src-bash">cat display_info.log
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><a href="root:Ran">root:Ran</a> with args: ('Kenny'</td>
<td class="org-right">26)</td>
<td class="org-left">and kwargs: {}</td>
</tr>
</tbody>
</table>

<p>
Let's try to <b>switch the decorators around</b>, this time we put <code>@my_timer</code> first, our result would be different:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">my_logger</span>(orig_func):
        <span style="color: #ff6188;">import</span> logging
        logging.basicConfig(filename=<span style="color: #ffd866;">'{}.log'</span>.<span style="color: #ab9df2;">format</span>(orig_func.<span style="color: #ab9df2;">__name__</span>), level=logging.INFO)

        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_log</span>(*args, **kwargs):
                logging.info(
                        <span style="color: #ffd866;">"Ran with args: {}, and kwargs: {}"</span>.<span style="color: #ab9df2;">format</span>(args, kwargs)
                )
                <span style="color: #ff6188;">return</span> orig_func(*args, **kwargs)

        <span style="color: #ff6188;">return</span> wrapper_log

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">my_timer</span>(orig_func):
        <span style="color: #ff6188;">import</span> time

        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper</span>(*args, **kwargs):
                <span style="color: #fcfcfa;">t1</span> = time.time()
                <span style="color: #fcfcfa;">result</span> = orig_func(*args, **kwargs)
                <span style="color: #fcfcfa;">t2</span> = time.time() - t1
                <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"{} ran in {} second(s)"</span>.<span style="color: #ab9df2;">format</span>(orig_func.<span style="color: #ab9df2;">__name__</span>, t2))
                <span style="color: #ff6188;">return</span> result
        
        <span style="color: #ff6188;">return</span> wrapper

<span style="color: #78dce8;">@my_timer</span>
<span style="color: #78dce8;">@my_logger</span>
<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">display_info</span>(name, age):
        <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"{name} is {age} years old."</span> )

display_info(<span style="color: #ffd866;">'Kenny'</span>, 26)

</pre>
</div>

<pre class="example">
Kenny is 26 years old.
wrapper_log ran in 0.006289482116699219 second(s)
</pre>


<p>
See how the <code>my_timer</code> times the log wrapper function instead of the original function? It's because the <code>my_timer</code> decorator actually wraps the wrapper function. That's actually not what we want.<br />
</p>

<p>
To make sure that we <b>preserve the information of our original function with multiple decorator</b>, we need to use the functool module and the wrap decorator when we stack multiple decorators together.<br />
</p>
</div>
</div>
</div>

<div id="outline-container-org60fcffc" class="outline-2">
<h2 id="org60fcffc">Stacking decorators with <b>functool</b> module and the <b>wrap</b> decorator</h2>
<div class="outline-text-2" id="text-org60fcffc">
<p>
It's quite confusing. We are putting a decorator wrap within a decorator.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #ff6188;">from</span> functools <span style="color: #ff6188;">import</span> wraps

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">my_logger</span>(orig_func):
        <span style="color: #ff6188;">import</span> logging
        logging.basicConfig(filename=<span style="color: #ffd866;">'{}.log'</span>.<span style="color: #ab9df2;">format</span>(orig_func.<span style="color: #ab9df2;">__name__</span>), level=logging.INFO)

        <span style="color: #78dce8;">@wraps</span>(orig_func)
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper_log</span>(*args, **kwargs):
                logging.info(
                        <span style="color: #ffd866;">"Ran with args: {}, and kwargs: {}"</span>.<span style="color: #ab9df2;">format</span>(args, kwargs)
                )
                <span style="color: #ff6188;">return</span> orig_func(*args, **kwargs)

        <span style="color: #ff6188;">return</span> wrapper_log

<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">my_timer</span>(orig_func):
        <span style="color: #ff6188;">import</span> time

        <span style="color: #78dce8;">@wraps</span>(orig_func)
        <span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">wrapper</span>(*args, **kwargs):
                <span style="color: #fcfcfa;">t1</span> = time.time()
                <span style="color: #fcfcfa;">result</span> = orig_func(*args, **kwargs)
                <span style="color: #fcfcfa;">t2</span> = time.time() - t1
                <span style="color: #ff6188;">print</span>(<span style="color: #ffd866;">"{} ran in {} second(s)"</span>.<span style="color: #ab9df2;">format</span>(orig_func.<span style="color: #ab9df2;">__name__</span>, t2))
                <span style="color: #ff6188;">return</span> result
        
        <span style="color: #ff6188;">return</span> wrapper

<span style="color: #78dce8;">@my_timer</span>
<span style="color: #78dce8;">@my_logger</span>
<span style="color: #ff6188;">def</span> <span style="color: #a9dc76;">display_info</span>(name, age):
        <span style="color: #ff6188;">print</span>(f<span style="color: #ffd866;">"{name} is {age} years old."</span> )

display_info(<span style="color: #ffd866;">'Kenny'</span>, 26)

</pre>
</div>

<pre class="example">
Kenny is 26 years old.
display_info ran in 0.013379096984863281 second(s)
</pre>


<p>
Adding the <code>funtools.wraps</code> decorator ensure that the information from the original function is preserved.<br />
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: <a href="https://akhsim.github.io/">Mishka Nguyen</a> </p>
                          <p><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.2.3)</p>
                          <p>Created: </p>
                          <p class="date">Updated: 2020-04-20 Mon 01:26</p>
</div>
</body>
</html>
